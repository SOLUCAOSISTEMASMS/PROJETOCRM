{% extends 'base.html' %}
{% block titulo %}Funcion√°rios{% endblock %}
{% block conteudo %}
<div class="container-fluid mt-4">

<form method="GET" action="{{ url_for('listar_funcionarios') }}" class="row g-2 mb-3 align-items-end">

  <!-- Campo de busca -->
  <div class="col-md-5">
    <input type="text" name="busca" class="form-control" placeholder="Buscar por nome, cargo ou email">
  </div>

  <!-- Bot√£o Buscar -->
  <div class="col-md-auto">
    <button type="submit" class="btn btn-outline-primary">
      <i class="bi bi-search"></i> Buscar
    </button>
  </div>
    <!-- Bot√£o Novo Funcion√°rio -->
  <div class="col-md-auto ms-auto">
    <a href="{{ url_for('criar_usuario') }}" class="btn btn-primary">
      <i class="bi bi-person-plus-fill"></i> Novo Funcion√°rio
    </a>
  </div>
</form>
<div class="container-fluid mt-4">

  <h3 class="d-flex align-items-center mb-4" style="font-weight: 600; font-size: 1.75rem;">
  <span class="badge text-dark me-2" style="background-color: #A7F7E9; font-size: 1.4rem;">
    <i class="bi bi-person-lines-fill"></i>
  </span>
  Lista de Funcion√°rios
</h3>

  {% if funcionarios %}
  
    <table class="table table-hover table-bordered align-middle table-theme-azul-claro">
      <thead>
    <tr>
      <th>Nome</th>
      <th>Login</th>
      <th>Email</th>
      <th>Tipo</th>
      <th>Status</th>
      <th>A√ß√µes</th>
    </tr>
  </thead>
  <tbody>
    {% for u in funcionarios %}

    <tr>
      <td>{{ u.nome }}</td>
      <td>{{ u.nome_usuario }}</td>
      <td>{{ u.email }}</td>
      <td><span class="badge bg-info text-dark">{{ u.tipo }}</span></td>
      <td>
        {% if u.ativo %}
          <span class="badge bg-success">Ativo</span>
        {% else %}
          <span class="badge bg-secondary">Inativo</span>
        {% endif %}
      </td>
      <td>
        <a href="/alternar_status/{{ u.id }}" class="btn btn-sm {% if u.ativo %}btn-warning{% else %}btn-success{% endif %}">
          {% if u.ativo %}Inativar{% else %}Reativar{% endif %}
        </a>
         {% if current_user.tipo == 'admin' %}
  <!-- ‚úÖ Admins t√™m acesso normal -->
  <a href="{{ url_for('editar_usuario', id=u.id) }}" class="btn btn-sm btn-primary">
    <i class="bi bi-pencil-square"></i> Editar
  </a>
{% else %}
  <!-- üîí N√£o-admin recebe pop-up -->
  <button type="button" class="btn btn-sm btn-secondary" onclick="Swal.fire({
  icon: 'warning',
  title: 'Acesso negado',
  text: 'Voc√™ n√£o tem permiss√£o para editar funcion√°rios.',
  confirmButtonText: 'Entendi'
})">
  <i class="bi bi-lock-fill"></i> Editar
</button>

{% endif %}

    
  </a>
      
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
  {% else %}
    <div class="alert alert-warning">Nenhum funcion√°rio cadastrado ainda.</div>
  {% endif %}
</div>
{% with messages = get_flashed_messages(category_filter=["success"]) %}
  {% for message in messages %}
    <script>
      Swal.fire({
        icon: 'success',
        title: 'Funcion√°rio',
        text: '{{ message }}',
        confirmButtonText: 'OK'
      });
    </script>
  {% endfor %}
{% endwith %}




{% endblock %}
